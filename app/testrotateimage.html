<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<p>Image to use:</p>
<img id="scream" width="40" height="40" src="images/drone.png" alt="The Scream" style="border:1px solid #d3d3d3;">

<p>Canvas:</p>
<canvas id="myCanvas" width="40" height="40" style="border:1px solid #d3d3d3;">
    Your browser does not support the HTML5 canvas tag.
</canvas>

<script>

    function agregaImagen(data64,msg){
        var domimage = new Image();
        domimage.src = data64;
        //domimage.width = canvas.width;
        var br = document.createElement('div');
        br.innerHTML = msg;

      document.body.appendChild(br);
        document.body.appendChild(domimage);
    }

    function otras() {
        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");
        var img = document.getElementById("scream");
        ctx.rotate(20*Math.PI/180);
        ctx.drawImage(img, 0, 0);

    }

    var RotateIcon = function (options) {
        options = options || {};
        var isComplete = (options.url !== undefined);

        isComplete = isComplete && (options.width !== undefined);

        isComplete = isComplete && (options.height !== undefined);

        if(!isComplete)
        {
            throw new Error("No se han ingresado los paramtros necesarios");
            return;
        }
        this.options = {};
        this.options.width = options.width;
        this.options.height = options.height;
        this.rImg = new Image();

        this.rImg.src = options.url;
        document.body.appendChild(this.rImg);
        var canvas = document.createElement("canvas");
        canvas.width = this.options.width;
        canvas.height = this.options.height;
        this.context = canvas.getContext("2d");
        this.canvas = canvas;

        this.getUrl= function () {
            this.context.save();
            this.context.restore();
            return this.canvas.toDataURL('image/png');
        };

        this.setRotation= function (options) {

          options = options || {};
          console.info((options.deg === undefined) && (options.rad  === undefined));
          if((options.deg === undefined) && (options.rad  === undefined))
            {
                throw new Error("No se han ingresado los paramtros necesarios");
                return;
            }

            var canvas = this.canvas,
                    degrees = options.deg ? options.deg :
                            options.rad* 180 / Math.PI ,
                    image = this.rImg,
                    ctx = this.context;
            console.info(degrees);
            console.info(canvas);
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.save();
            ctx.translate(canvas.width/2,canvas.height/2);
            ctx.rotate(degrees*Math.PI/180);

            if(degrees%180==0){
                ctx.drawImage(image, -image.width/2,-image.height/2);
            }else{
                ctx.drawImage(image, -image.width/2,-canvas.width/2,image.width, canvas.width);
            }
            ctx.restore();
        };

        this.setRotation({deg:0});
    };



    window.onload =function(){
        /*var degrees = 90;
        var canvas = document.getElementById("myCanvas");
        var image = document.getElementById("scream");
        var ctx = canvas.getContext("2d");
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.save();
        ctx.translate(canvas.width/2,canvas.height/2);
        ctx.rotate(degrees*Math.PI/180);

        if(degrees%180==0){
            ctx.drawImage(image, -image.width/2,-image.height/2);
        }else{
            ctx.drawImage(image, -image.width/2,-canvas.width/2,image.width, canvas.width);
        }
        ctx.restore();
        var data64 = canvas.toDataURL('image/png');


        agregaImagen(data64,"primer");
*/
        var icon = new RotateIcon({
            url:'images/drone.png'
            ,width:40
            ,height:40
        });

        var urlOrigi = icon.getUrl();
        console.info("sin rotar",urlOrigi);
        agregaImagen(urlOrigi,"original");
        for (var i=-360;i<360;i++) {
            var grados = i*10;
            icon.setRotation({
                deg: grados
            });
            var url = icon.getUrl();
            console.info("rotando", url);
            agregaImagen(url, grados);
            console.info(urlOrigi.length, url.length);
        }


    };

</script>
</body>
</html>
